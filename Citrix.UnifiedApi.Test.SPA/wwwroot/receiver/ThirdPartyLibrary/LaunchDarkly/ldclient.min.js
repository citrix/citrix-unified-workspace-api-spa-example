!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.LDClient=n():e.LDClient=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){function r(e,n,t){function r(e){E({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})}function v(e,n,t){var r=_.getUser(),o=JSON.stringify(n)+(r&&r.key?r.key:"")+e,i=new Date,a=Z[o];a&&i-a<3e5||(Z[o]=i,E({kind:"feature",key:e,user:r,value:n,"default":t,creationDate:i.getTime()}))}function h(e,n){var t={kind:e,key:n.key,data:null,url:window.location.href,creationDate:(new Date).getTime()};return"click"===e&&(t.selector=n.selector),E(t)}function y(e,n,t){return f.wrapPromiseCallback(new Promise(function(t,r){_.setUser(e),j.fetchFlagSettings(_.getUser(),n,function(e,n){return e?(K.maybeReportError(new g.LDFlagFetchError(d.errorFetchingFlags(e))),r(e)):(n&&N(n),void t(n))})}.bind(this)),t)}function m(e,n){var t;return t=Y&&Y.hasOwnProperty(e)?null===Y[e]?n:Y[e]:n,v(e,t,n),t}function E(e){w()&&C.enqueue(e)}function w(){return J&&!k()&&(0===P||0===Math.floor(Math.random()*P))}function k(){var e;return e=navigator&&void 0!==navigator.doNotTrack?navigator.doNotTrack:navigator&&void 0!==navigator.msDoNotTrack?navigator.msDoNotTrack:window.doNotTrack,"1"===e||"yes"===e}function b(){var e={};if(!Y)return e;for(var n in Y)Y.hasOwnProperty(n)&&(e[n]=m(n,null));return e}function x(e){if(!X||0===X.length)return!1;for(var n=0;n<X.length;n++)if("custom"===X[n].kind&&X[n].key===e)return!0;return!1}function S(e,n){return"string"!=typeof e?void K.maybeReportError(new g.LDInvalidEventKeyError(d.unknownCustomEventKey(e))):(X&&!x(e)&&console.warn(d.unknownCustomEventKey(e)),void E({kind:"custom",key:e,data:n,url:window.location.href,creationDate:(new Date).getTime()}))}function L(){A.connect(function(){j.fetchFlagSettings(_.getUser(),q,function(e,n){e&&K.maybeReportError(new g.LDFlagFetchError(d.errorFetchingFlags(e))),N(n)})})}function N(e){var n,t;e&&(n=f.modifications(Y,e),t=Object.keys(n),Y=e,$&&(p.clear(B),B=F(O,_.getUser()),p.set(B,JSON.stringify(Y))),t.length>0&&(t.forEach(function(e){K.emit(V+":"+e,n[e].current,n[e].previous)}),K.emit(V,n),t.forEach(function(e){v(e,n[e].current)})))}function D(e,n,t){e.substr(0,V.length)===V?(A.isConnected()||L(),K.on.apply(K,[e,n,t])):K.on.apply(K,Array.prototype.slice.call(arguments))}function T(){K.off.apply(K,Array.prototype.slice.call(arguments))}function U(e){if(e.origin===G&&"SYN"===e.data.type){window.editorClientBaseUrl=G;var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=G+e.data.editorClientUrl;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}}function F(e,n){var t="";return n&&(t=q||f.btoa(JSON.stringify(n))),"ld:"+e+":"+t}function R(){J&&setTimeout(function e(){C.flush(_.getUser()),setTimeout(e,W)},W)}function I(){M&&M.dispose(),X&&X.length&&(M=c(X,h))}var O,C,j,A,J,P,K,q,_,G,z,H,M,$,B,X,Y={},Q="ready",V="change",W=2e3,Z={};if(t=t||{},O=e,Y="object"==typeof t.bootstrap?t.bootstrap:{},q=t.hash,G=t.baseUrl||"https://app.launchdarkly.com",z=t.eventsUrl||"https://events.launchdarkly.com",H=t.streamUrl||"https://clientstream.launchdarkly.com",A=u(H,O),C=o(z+"/a/"+O+".gif",a(t)),J="undefined"==typeof t.sendEvents||config.sendEvents,P=parseInt(t.samplingInterval)||0,K=i(),_=l(n,r),j=s(G,O,t.useReport),B=F(O,_.getUser()),void 0!==t.samplingInterval&&(isNaN(t.samplingInterval)||t.samplingInterval<0)&&(P=0,f.onNextTick(function(){K.maybeReportError(new g.LDInvalidArgumentError("Invalid sampling interval configured. Sampling interval must be an integer >= 0."))})),e||f.onNextTick(function(){K.maybeReportError(new g.LDInvalidEnvironmentIdError(d.environmentNotSpecified()))}),n?n.key||f.onNextTick(function(){K.maybeReportError(new g.LDInvalidUserError(d.invalidUser()))}):f.onNextTick(function(){K.maybeReportError(new g.LDInvalidUserError(d.userNotSpecified()))}),"object"==typeof t.bootstrap)f.onNextTick(function(){K.emit(Q)});else if("string"==typeof t.bootstrap&&"LOCALSTORAGE"===t.bootstrap.toUpperCase()&&"undefined"!=typeof Storage){$=!0;try{Y=JSON.parse(p.get(B))}catch(ee){p.clear(B)}null===Y?j.fetchFlagSettings(_.getUser(),q,function(e,n){e&&K.maybeReportError(new g.LDFlagFetchError(d.errorFetchingFlags(e))),Y=n,n&&p.set(B,JSON.stringify(Y)),K.emit(Q)}):(f.onNextTick(function(){K.emit(Q)}),j.fetchFlagSettings(_.getUser(),q,function(e,n){e&&K.maybeReportError(new g.LDFlagFetchError(d.errorFetchingFlags(e))),n&&p.set(B,JSON.stringify(n))}))}else j.fetchFlagSettings(_.getUser(),q,function(e,n){e&&K.maybeReportError(new g.LDFlagFetchError(d.errorFetchingFlags(e))),Y=n,K.emit(Q)});j.fetchGoals(function(e,n){e&&K.maybeReportError(new g.LDUnexpectedResponseError(e.message)),n&&n.length>0&&(X=n,M=c(X,h))}),"complete"!==document.readyState?window.addEventListener("load",R):R(),window.addEventListener("beforeunload",function(){C.flush(_.getUser(),!0)}),X&&X.length>0&&(window.history&&history.pushState?window.addEventListener("popstate",I):window.addEventListener("hashchange",I)),window.addEventListener("message",U);var ne=new Promise(function(e){var n=K.on(Q,function(){K.off(Q,n),e()})}),te={waitUntilReady:function(){return ne},identify:y,variation:m,track:S,on:D,off:T,allFlags:b};return te}var o=t(7),i=t(6),a=t(8),c=t(9),u=t(12),s=t(11),l=t(10),f=t(1),d=t(2),p=t(13),g=t(3);e.exports={initialize:r},e.exports.version="1.5.1"},function(e,n,t){function r(e){return l.btoa(unescape(encodeURIComponent(e)))}function o(e){return r(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function i(e){return JSON.parse(JSON.stringify(e))}function a(e,n){var t={};if(!e||!n)return{};for(var r in e)e.hasOwnProperty(r)&&n[r]!==e[r]&&(t[r]={previous:e[r],current:n[r]});return t}function c(e){setTimeout(e,0)}function u(e,n){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t}function s(e,n){return e.then(function(e){return n&&setTimeout(function(){n(null,e)},0),e},function(e){return n&&setTimeout(function(){n(e,null)},0),Promise.reject(e)})}var l=t(4);e.exports={btoa:r,base64URLEncode:o,clone:i,modifications:a,merge:u,onNextTick:c,wrapPromiseCallback:s}},function(e,n){var t=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.";e.exports={clientNotReady:function(){return"LaunchDarkly client is not ready"},invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:function(){return"localStorage is unavailable"},unknownCustomEventKey:function(e){return'Custom event "'+e+'" does not exist'},environmentNotFound:function(){return"Environment not found."+t},environmentNotSpecified:function(){return"No environment specified."+t},errorFetchingFlags:function(e){return"Error fetching flag settings: "+(e.message||e)},userNotSpecified:function(){return"No user specified."+t},invalidUser:function(){return"Invalid user specified."+t}}},function(e,n){function t(e){function n(e,n){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=n}return n.prototype=new Error,n.prototype.name=e,n.prototype.constructor=n,n}n.LDUnexpectedResponseError=t("LaunchDarklyUnexpectedResponseError"),n.LDInvalidEnvironmentIdError=t("LaunchDarklyInvalidEnvironmentIdError"),n.LDInvalidUserError=t("LaunchDarklyInvalidUserError"),n.LDInvalidEventKeyError=t("LaunchDarklyInvalidEventKeyError"),n.LDInvalidArgumentError=t("LaunchDarklyInvalidArgumentError"),n.LDFlagFetchError=t("LaunchDarklyFlagFetchError")},function(e,n,t){!function(){function e(e){this.message=e}var t=n,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(n){for(var t,o,i=String(n),a=0,c=r,u="";i.charAt(0|a)||(c="=",a%1);u+=c.charAt(63&t>>8-a%1*8)){if(o=i.charCodeAt(a+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|o}return u}),t.atob||(t.atob=function(n){var t=String(n).replace(/=+$/,"");if(t.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,c=0,u="";i=t.charAt(c++);~i&&(o=a%4?64*o+i:i,a++%4)?u+=String.fromCharCode(255&o>>(-2*a&6)):0)i=r.indexOf(i);return u})}()},function(e,n){"use strict";var t=/[|\\{}()[\]^$+*?.]/g;e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(t,"\\$&")}},function(e,n){function t(){var e={},n={},t=function(e){return!!n[e]};return e.on=function(e,t,r){n[e]=n[e]||[],n[e]=n[e].concat({handler:t,context:r})},e.off=function(e,t,r){if(n[e])for(var o=0;o<n[e].length;o++)n[e][o].handler===t&&n[e][o].context===r&&(n[e]=n[e].slice(0,o).concat(n[e].slice(o+1)))},e.emit=function(e){if(n[e])for(var t=0;t<n[e].length;t++)n[e][t].handler.apply(n[e][t].context,Array.prototype.slice.call(arguments,1))},e.maybeReportError=function(e){e&&(t("error")?this.emit("error",e):console.error(e.message))},e}e.exports=t},function(e,n,t){function r(e,n){var t={},r=[],i=!0;return t.enqueue=function(e){r.push(e)},t.flush=function(a,c){var u=2e3-e.length,s=[];if(!a)return i&&console&&console.warn&&console.warn("Be sure to call `identify` in the LaunchDarkly client: http://docs.launchdarkly.com/docs/running-an-ab-test#include-the-client-side-snippet"),!1;for(i=!1;u>0&&r.length>0;){var l=r.pop();l.user=a,u-=o.base64URLEncode(JSON.stringify(l)).length,u<0&&s.length>0?r.push(l):s.push(l)}if(s.length>0){s=n.serialize_events(s);var f=e+"?d="+o.base64URLEncode(JSON.stringify(s));if("withCredentials"in new XMLHttpRequest){var d=new XMLHttpRequest;d.open("GET",f,!c),d.send()}else{var p=new Image;p.src=f}}return r.length>0&&(c?t.flush(a,c):setTimeout(function(){t.flush(a)},0)),!1},t}var o=t(1);e.exports=r},function(e,n,t){function r(e){function n(e){return Object.keys(e).map(function(n){return[n,"user"===n?t(e[n]):e[n]]}).reduce(function(e,n){return e[n[0]]=n[1],e},{})}function t(e){var n=e.privateAttributeNames||[],t=function(e){return!c[e]&&(i||n.indexOf(e)!==-1||a.indexOf(e)!==-1)},r=function(e,n){return Object.keys(e).reduce(function(r,o){return n(o)&&(t(o)?r[1][o]=!0:r[0][o]=e[o]),r},[{},{}])},s=r(e,function(e){return u[e]}),l=s[0],f=s[1];if(e.custom){var d=r(e.custom,function(e){return!0});l.custom=d[0],o.merge(f,d[1])}var p=Object.keys(f);return p.length&&(p.sort(),l.privateAttrs=p),l}var r={},i=e.all_attributes_private,a=e.private_attribute_names||[],c={key:!0,custom:!0,anonymous:!0},u={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return r.serialize_events=function(e){return e.map(n)},r}var o=t(1);e.exports=r},function(e,n,t){function r(e,n,t,r){var o,i,c=n.replace(t,"").replace(r,"");switch(e.kind){case"exact":i=n,o=new RegExp("^"+a(e.url)+"/?$");break;case"canonical":i=c,o=new RegExp("^"+a(e.url)+"/?$");break;case"substring":i=c,o=new RegExp(".*"+a(e.substring)+".*$");break;case"regex":i=c,o=new RegExp(e.pattern);break;default:return!1}return o.test(i)}function o(e,n){for(var t=[],r=0;r<n.length;r++)for(var o=e.target,i=n[r],a=i.selector,c=document.querySelectorAll(a);o&&c.length>0;){for(var u=0;u<c.length;u++)o===c[u]&&t.push(i);o=o.parentNode}return t}function i(e,n){for(var t={},e=e,i=null,a=[],c=0;c<e.length;c++)for(var u=e[c],s=u.urls||[],l=0;l<s.length;l++)if(r(s[l],location.href,location.search,location.hash)){"pageview"===u.kind?n("pageview",u):(a.push(u),n("click_pageview",u));break}return a.length>0&&(i=function(e){for(var t=o(e,a),r=0;r<t.length;r++)n("click",t[r])},document.addEventListener("click",i)),t.dispose=function(){document.removeEventListener("click",i)},t}var a=t(5);e.exports=i},function(e,n,t){function r(e){var n=i.clone(e);return n.key&&(n.key=n.key.toString()),n}function o(e,n){var t,o={};return o.setUser=function(e){t=r(e),n(i.clone(t))},o.getUser=function(){return i.clone(t)},e&&o.setUser(e),o}var i=t(1);e.exports=o},function(e,n,t){function r(e,n,t){var r=new XMLHttpRequest;return r.addEventListener("load",function(){200===r.status&&r.getResponseHeader("Content-type")===u?t(null,JSON.parse(r.responseText)):t(r.statusText)}),r.addEventListener("error",function(){404===r.status&&t(new a.LDInvalidEnvironmentIdError(c.environmentNotFound())),t(r.statusText)}),n?(r.open("REPORT",e),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(n))):(r.open("GET",e),r.send()),r}function o(e,n,t){var o,a,c={};return c.fetchFlagSettings=function(c,u,s){var l,f,d,p;t?(f=[e,"/sdk/eval/",n,"/user",u?"?h="+u:""].join(""),d=c):(l=i.base64URLEncode(JSON.stringify(c)),f=[e,"/sdk/eval/",n,"/users/",l,u?"?h="+u:""].join(""));var g=function(e){return function(){e.apply(null,arguments),o=null,a=null}}(s);o?(o.abort(),p=function(e){return function(){e&&e.apply(null,arguments),g.apply(null,arguments)}}(a)):p=g,a=p,o=r(f,d,p)},c.fetchGoals=function(t){var o=[e,"/sdk/goals/",n].join("");r(o,null,t)},c}var i=t(1),a=t(3),c=t(2),u="application/json";e.exports=o},function(e,n){function t(e,n){var t={},e=e+"/ping/"+n,r=null;return t.connect=function(n){"undefined"!=typeof EventSource&&(r=new window.EventSource(e),r.addEventListener("ping",n))},t.disconnect=function(){r&&r.close()},t.isConnected=function(){return r&&(r.readyState===EventSource.OPEN||r.readyState===EventSource.CONNECTING)},t}e.exports=t},function(e,n,t){function r(e){try{return window.localStorage.getItem(e)}catch(n){console.warn(a.localStorageUnavailable())}}function o(e,n){try{window.localStorage.setItem(e,n)}catch(t){console.warn(a.localStorageUnavailable())}}function i(e){o(e,null)}var a=t(2);e.exports={get:r,set:o,clear:i}}])});